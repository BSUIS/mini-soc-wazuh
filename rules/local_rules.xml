<group name="local,syslog,sshd">
  
  <!-- SSH Failed Login Detection -->
  <rule id="100001" level="5">
    <if_sid>5716</if_sid>
    <description>SSH failed login detected</description>
    <group>authentication_failed,ssh</group>
  </rule>

  <!-- SSH Failed Login Aggregation -->
  <rule id="100002" level="10" frequency="3" timeframe="60">
    <if_matched_sid>100001</if_matched_sid>
    <same_source_ip />
    <description>Multiple SSH failed logins from same IP: $(srcip)</description>
    <group>authentication_failures,ssh</group>
  </rule>

  <!-- SSH Successful Login After Failed Attempts -->
  <rule id="100003" level="12">
    <if_sid>5715</if_sid>
    <if_matched_sid>100002</if_matched_sid>
    <same_source_ip />
    <description>SSH successful login from $(srcip) for user $(user) after multiple failed attempts - Possible brute force success</description>
    <group>authentication_success,ssh,attack</group>
    <mitre>
      <id>T1110</id>
    </mitre>
  </rule>

</group>
